/**
 * Tweetsie - Twitter plugin built with JS! 'cause I mean why the hello not?!
 * @version v0.3.0
 * @author Phil Hughes <me@iamphill.com>
 * @license MIT
 */
"use strict";var _prototypeProperties=function(e,t,r){t&&Object.defineProperties(e,t),r&&Object.defineProperties(e.prototype,r)},_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},TWITTER_CALLBACK_FUNCTION_NAME="TWEETSIE_CALLBACK",Tweetsie=function(){function Tweetsie(e){var t=this;_classCallCheck(this,Tweetsie),this.opts=e;var r="undefined"!=typeof ES6Promise?ES6Promise.Promise:Promise;return new r(function(e,r){return t.resolve=e,t.reject=r,void 0===t.opts?void t.error("No object was passed to Tweetsie"):void 0===t.opts.widgetid?void t.error("Must pass in a `widgetid`"):void t.initRequest()})}return _prototypeProperties(Tweetsie,null,{error:{value:function(e){void 0!==this.reject&&this.reject(e)},writable:!0,configurable:!0},initRequest:{value:function(){this.generateUrl(),this.requestCallback(),this.sendRequest()},writable:!0,configurable:!0},sendRequest:{value:function(){var e=document.createElement("script");e.async=!0,e.src=this.url,e.onload=function(){document.head.removeChild(e)},document.head.appendChild(e)},writable:!0,configurable:!0},generateUrl:{value:function(){this.url="https://cdn.syndication.twimg.com/widgets/timelines/"+this.opts.widgetid+"?suppress_response_codes=true&callback="+TWITTER_CALLBACK_FUNCTION_NAME},writable:!0,configurable:!0},requestCallback:{value:function(){var e=this;window[TWITTER_CALLBACK_FUNCTION_NAME]=function(t){void 0!==t.headers&&404===t.headers.status?e.notFoundError(t.headers.message):e.parseBody(t.body)}},writable:!0,configurable:!0},notFoundError:{value:function(e){this.error("Twitter responded with: "+e)},writable:!0,configurable:!0},parseBody:{value:function(e){this.dom=document.implementation.createHTMLDocument(""),this.dom.body.innerHTML=e,this.getTweetStream(),this.getAllTweets(),this.loopTweets(),void 0!==this.opts.template&&this.parseTemplate(),void 0!==this.resolve&&this.resolve(this.tweets)},writable:!0,configurable:!0},loopTweets:{value:function(){this.tweets=[];for(var e=this.getTweetCountToReturn(this.alltweets),t=0;e>t;t++){var r=this.alltweets[t],i={id:this.getTweetID(r),tweet_url:this.getTweetUrl(r),date:this.getTweetDate(r),author:this.getTweetAuthorObject(r),body:this.getTweetBody(r),actions:this.getTweetActions(r)};this.tweets.push(i)}},writable:!0,configurable:!0},getTweetCountToReturn:{value:function(e){return void 0!==this.opts.count?this.opts.count>e.length?e.length:this.opts.count:e.length},writable:!0,configurable:!0},getTweetStream:{value:function(){this.stream=this.dom.getElementsByClassName("h-feed")[0]},writable:!0,configurable:!0},getAllTweets:{value:function(){this.alltweets=this.stream.querySelectorAll("li.h-entry")},writable:!0,configurable:!0},getTweetID:{value:function(e){return e.getAttribute("data-tweet-id")},writable:!0,configurable:!0},getTweetUrl:{value:function(e){return e.querySelectorAll(".u-url")[0].getAttribute("href")},writable:!0,configurable:!0},getTweetDate:{value:function(e){return new Date(e.querySelectorAll(".u-url .dt-updated")[0].getAttribute("datetime"))},writable:!0,configurable:!0},getAuthorUsername:{value:function(e){return e.querySelectorAll(".p-nickname b")[0].innerHTML},writable:!0,configurable:!0},getAuthorName:{value:function(e){return e.querySelectorAll(".full-name .p-name")[0].innerHTML},writable:!0,configurable:!0},getAuthorUrl:{value:function(e){return e.querySelectorAll(".u-url.profile")[0].getAttribute("href")},writable:!0,configurable:!0},getAuthorAvatar:{value:function(e){return e.querySelectorAll(".u-url.profile .avatar")[0].getAttribute("src")},writable:!0,configurable:!0},getTweetAuthorObject:{value:function(e){return{avatar:this.getAuthorAvatar(e),profile_url:this.getAuthorUrl(e),name:this.getAuthorName(e),username:this.getAuthorUsername(e)}},writable:!0,configurable:!0},getTweetBody:{value:function(e){return e.querySelectorAll(".e-entry-content .e-entry-title")[0].innerHTML},writable:!0,configurable:!0},getTweetActions:{value:function(e){return{reply:e.querySelectorAll(".reply-action")[0].getAttribute("href"),favorite:e.querySelectorAll(".favorite-action")[0].getAttribute("href"),retweet:e.querySelectorAll(".retweet-action")[0].getAttribute("href")}},writable:!0,configurable:!0},parseTemplate:{value:function parseTemplate(){var _this=this,outputhtml="",temp=this.opts.template,regex=new RegExp(/{{(.*?)}}/g),bracesRegex=new RegExp(/({{|}})/g),matches=temp.match(regex);return null===matches?void this.error("No variables entered into the template"):(this.tweets.forEach(function(tweet){var tweethtml='<div data-tweetsie-id="'+tweet.id+'">'+temp+"</div>";matches.forEach(function(match){var tmptweet=tweet,varname=match.replace(bracesRegex,"").trim(),filters=varname.split("|"),prefilterval=eval('tweet["'+varname.split("|")[0].trim().split(".").join('"]["')+'"]'),value=prefilterval;filters.length>1&&filters.filter(function(e,t){return t>0}).forEach(function(e){var t=_this["filter_"+e.trim()];void 0!==t?value=t.call(_this,prefilterval,!1):void 0!==_this.opts.filters&&void 0!==_this.opts.filters[""+e.trim()]&&(value=_this.opts.filters[""+e.trim()].call(_this,prefilterval))}),void 0!==value&&(tweethtml=tweethtml.replace(match,value))}),outputhtml+=tweethtml}),void this.appendOutputToContainer(outputhtml))},writable:!0,configurable:!0},getContainer:{value:function(){if("string"==typeof this.opts.container){var e=this.opts.container;return 0===e.indexOf("#")&&(e=e.substring(1,e.length)),document.getElementById(e)}return this.opts.container},writable:!0,configurable:!0},appendOutputToContainer:{value:function(e){if(void 0===this.opts.container)return void this.error("No container passed to Tweetsie");var t=this.getContainer();t.innerHTML=e,t.querySelectorAll(".tweetsie-auto-date").length>0&&this.filter_autodate(null,!0),void 0!==this.opts.callback&&this.opts.callback(this.tweets)},writable:!0,configurable:!0},filter_autodate:{value:function(e,t){var r=this;if(!t){var i=function(e){return 10>e?"0"+e:e},a=e.getTime(),o=""+e.getFullYear()+"-"+i(e.getMonth()+1)+"-"+i(e.getDate())+"T"+i(e.getHours())+":"+i(e.getMinutes())+":"+i(e.getSeconds())+"Z",n=document.createElement("time");return n.className="tweetsie-auto-date",n.setAttribute("datetime",o),n.setAttribute("data-tweetsie-time",a),n.textContent=this.filter_formatdate(e),n.outerHTML}!function(){var e=r.getContainer().querySelectorAll(".tweetsie-auto-date");setInterval(function(){for(var t=0;t<e.length;t++){var i=e[t],a=new Date(parseInt(i.getAttribute("data-tweetsie-time"),10)),o=r.filter_formatdate(a);o!==i.textContent&&(console.log("a"),i.textContent=o)}},1e3)}()},writable:!0,configurable:!0},filter_formatdate:{value:function(e){var t=e.getTime(),r=(new Date).getTime(),i=(r-t)/1e3,a=Math.floor(i/86400);return 60>i?"just now":120>i?"1 min ago":3600>i?""+Math.floor(i/60)+" mins ago":7200>i?"1 hour ago":86400>i?""+Math.floor(i/3600)+" hours ago":1===a?"Yesterday":7>a?""+a+" days ago":7===a?"1 week ago":31>a?""+Math.ceil(a/7)+" weeks ago":365>a?""+Math.ceil(a/30)+" months ago":"A long time ago"},writable:!0,configurable:!0}}),Tweetsie}();